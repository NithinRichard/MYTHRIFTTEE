{{ 'component-card.css' | asset_url | stylesheet_tag }}
{{ 'component-price.css' | asset_url | stylesheet_tag }}
{{ 'component-product-grid.css' | asset_url | stylesheet_tag }}

<div class="page-width wishlist-page">
  <h1 class="main-page-title page-title h0" style="font-family: 'VCR OSD Mono', monospace !important;">
    {{ page.title | escape }}
  </h1>
  <div class="rte">
    {{ page.content }}
  </div>

  <div id="wishlist-grid" class="grid product-grid grid--2-col-tablet-down grid--4-col-desktop">
    <!-- Wishlist items will be populated here via JS -->
    <p class="wishlist-empty-msg hidden">{{ 'templates.contact.form.error_heading' | t }} Your wishlist is empty.</p>
    <div class="wishlist-loader">Loading...</div>
  </div>
</div>

<script src="{{ 'product-card.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'product-card-link.js' | asset_url }}" defer="defer"></script>
<script src="{{ 'wishlist.js' | asset_url }}" defer="defer"></script>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const wishlistGrid = document.getElementById('wishlist-grid');
    const loader = wishlistGrid.querySelector('.wishlist-loader');
    const emptyMsg = wishlistGrid.querySelector('.wishlist-empty-msg');
    
    const getWishlistItems = () => {
      try {
        const items = localStorage.getItem('shopify-wishlist');
        return items ? JSON.parse(items) : [];
      } catch (e) {
        console.error('Error reading wishlist from LocalStorage:', e);
        return [];
      }
    };

    const items = getWishlistItems();

    if (items.length === 0) {
      loader.classList.add('hidden');
      emptyMsg.classList.remove('hidden');
      emptyMsg.textContent = "Your wishlist is currently empty.";
      return;
    }

    // Fetch product cards
    const fetchProductCard = async (handle) => {
      try {
        const url = `/products/${handle}?view=card`;
        const response = await fetch(url);
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const text = await response.text();
        return text;
      } catch (error) {
        console.error(`Error fetching product ${handle}:`, error);
        return null;
      }
    };

    const productCards = await Promise.all(items.map(handle => fetchProductCard(handle)));
    
    loader.classList.add('hidden');
    
    productCards.forEach((html, index) => {
      if (html && html.trim().length > 0) {
        const div = document.createElement('div');
        div.classList.add('grid__item');
        div.innerHTML = html;
        wishlistGrid.appendChild(div);
      }
    });

    if (window.wishlist) {
      window.wishlist.updateButtons();
    }
  });
</script>

<style>
  .wishlist-page {
    padding-top: 3rem;
    padding-bottom: 3rem;
  }
  
  /* Force hide preloader on this page */
  #preloader {
    display: none !important;
    z-index: -1 !important;
    opacity: 0 !important;
    pointer-events: none !important;
  }

  .wishlist-loader {
    text-align: center;
    width: 100%;
    padding: 2rem;
  }
  
  /* Wishlist Product Card Styles */
  .product-card__image-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 100%; /* Square aspect ratio */
    overflow: hidden;
    border-radius: var(--border-radius, 0);
    background-color: #f4f4f4;
    margin-bottom: 1rem;
  }

  .product-card__image {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .product-card__link:hover .product-card__image {
    transform: scale(1.05);
  }

  .product-card__info {
    text-align: left;
  }

  .product-card__title {
    display: block;
    font-size: 1.4rem;
    font-weight: 500;
    color: inherit;
    text-decoration: none;
    margin-bottom: 0.5rem;
    line-height: 1.3;
  }

  .product-card__title:hover {
    text-decoration: underline;
  }

  .product-card__price {
    font-size: 1.4rem;
  }

  /* Responsive Grid Overrides */
  @media screen and (max-width: 749px) {
    #wishlist-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
    
    .wishlist-page {
      padding-top: 2rem;
      padding-bottom: 2rem;
    }
  }
</style>

{% schema %}
{
  "name": "Wishlist Page",
  "tag": "section",
  "class": "section",
  "settings": []
}
{% endschema %}
